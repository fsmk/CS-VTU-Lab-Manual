CREATE SCHEMA BANK;

USE BANK;

CREATE TABLE BRANCH
(
BNAME VARCHAR(10) PRIMARY KEY,
CITY VARCHAR(10),
ASSETS REAL
);

CREATE TABLE ACCOUNT
(
ACCNO INT PRIMARY KEY,
BNAME VARCHAR(10),
BALANCE REAL,
FOREIGN KEY(BNAME) REFERENCES BRANCH(BNAME)
);

CREATE TABLE CUST
(
CNAME VARCHAR(10) PRIMARY KEY,
CSTREET VARCHAR(10) NOT NULL,
CITY VARCHAR(10) NOT NULL
);

CREATE TABLE DEPOSITOR
(
CNAME VARCHAR(10),
ACCNO INT,
PRIMARY KEY(CNAME,ACCNO),
FOREIGN KEY(ACCNO) REFERENCES ACCOUNT(ACCNO) ON DELETE CASCADE,
FOREIGN KEY(CNAME) REFERENCES CUST(CNAME) ON DELETE CASCADE
);

CREATE TABLE LOAN
(
LNO INT PRIMARY KEY,
BNAME VARCHAR(10) NOT NULL,
AMT REAL,
FOREIGN KEY(BNAME) REFERENCES BRANCH(BNAME) ON DELETE CASCADE
);

CREATE TABLE BORROWER
(
CNAME VARCHAR(10),
LNO INT,
PRIMARY KEY(CNAME,LNO),
FOREIGN KEY(CNAME) REFERENCES CUST(CNAME) ON DELETE CASCADE,
FOREIGN KEY(LNO) REFERENCES LOAN(LNO) ON DELETE CASCADE
);



INSERT INTO BRANCH VALUES('MAIN','BLR',2500000); 
INSERT INTO BRANCH VALUES('BLRSUB1','BLR',4110000);
INSERT INTO BRANCH VALUES('BLRSUB2','BLR',4330000);
INSERT INTO BRANCH VALUES('BLRSUB3','BLR',400300);
INSERT INTO BRANCH VALUES('BLRSUB4','BLR',4001000);
INSERT INTO BRANCH VALUES('BLRSUB5','BLR',2300000);
INSERT INTO BRANCH VALUES('BLRSUB6','BLR',1900000);

INSERT INTO BRANCH VALUES('MLRBRANCH','MLR',300000);
INSERT INTO BRANCH VALUES('MLRSUB1','MLR',300000);
INSERT INTO BRANCH VALUES('MLRSUB2','MLR',344000);
INSERT INTO BRANCH VALUES('MLRSUB3','MLR',355000);
INSERT INTO BRANCH VALUES('MLRSUB4','MLR',125000);

INSERT INTO BRANCH VALUES('MNDYABRANCH','MANDYA',300000);
INSERT INTO BRANCH VALUES('MNDYSUB1','MANDYA',300000);

INSERT INTO BRANCH VALUES('MYSBRANCH','MYSORE',100002000);

INSERT INTO BRANCH VALUES('SHMBRANCH','SHIMOGA',9000000);




INSERT INTO  ACCOUNT VALUES(1,'MAIN',25000);
INSERT INTO  ACCOUNT VALUES(2,'MAIN',12000);
INSERT INTO  ACCOUNT VALUES(20,'MAIN',235000);
INSERT INTO  ACCOUNT VALUES(21,'MAIN',13000);
INSERT INTO  ACCOUNT VALUES(22,'MAIN',13000);
INSERT INTO  ACCOUNT VALUES(3,'MLRBRANCH',1000);
INSERT INTO  ACCOUNT VALUES(4,'BLRSUB1',10000);
INSERT INTO  ACCOUNT VALUES(5,'BLRSUB1',600000);
INSERT INTO  ACCOUNT VALUES(6,'BLRSUB2',50000);
INSERT INTO  ACCOUNT VALUES(7,'BLRSUB3',50000);
INSERT INTO  ACCOUNT VALUES(8,'BLRSUB4',50000);
INSERT INTO  ACCOUNT VALUES(9,'BLRSUB6',150000);
INSERT INTO  ACCOUNT VALUES(19,'BLRSUB5',150000);
INSERT INTO  ACCOUNT VALUES(23,'BLRSUB1',600000);
INSERT INTO  ACCOUNT VALUES(24,'BLRSUB2',50000);
INSERT INTO  ACCOUNT VALUES(25,'BLRSUB3',50000);
INSERT INTO  ACCOUNT VALUES(26,'BLRSUB4',50000);
INSERT INTO  ACCOUNT VALUES(27,'BLRSUB6',150000);
INSERT INTO  ACCOUNT VALUES(28,'BLRSUB5',150000);
INSERT INTO  ACCOUNT VALUES(11,'MLRSUB1',50000);
INSERT INTO  ACCOUNT VALUES(12,'MLRSUB2',50000);
INSERT INTO  ACCOUNT VALUES(13,'MLRSUB3',50000);
INSERT INTO  ACCOUNT VALUES(14,'MLRSUB4',50000);
INSERT INTO  ACCOUNT VALUES(15,'MNDYABRANCH',50000);
INSERT INTO  ACCOUNT VALUES(16,'MYSBRANCH',250000);
INSERT INTO  ACCOUNT VALUES(17,'SHMGABRANCH',55000);
INSERT INTO  ACCOUNT VALUES(18,'SHMGABRANCH',55700000);

INSERT INTO CUST VALUES('STAN','BAKER STREET','BLR');
INSERT INTO CUST VALUES('ERIC','ROBIN','BLR');
INSERT INTO CUST VALUES('KYLE','KINGDOM','BLR');
INSERT INTO CUST VALUES('BUTTERS','JOGGERS STREET','DEL');
INSERT INTO CUST VALUES('LILA','FREDRICK III','MUM');
INSERT INTO CUST VALUES('DEXTER','JOHN PAUL','HYD');
INSERT INTO CUST VALUES('HOUSE','SIFON STREET','CHNI');

INSERT INTO DEPOSITOR VALUES('HOUSE',22);
INSERT INTO DEPOSITOR VALUES('HOUSE',23);
INSERT INTO DEPOSITOR VALUES('HOUSE',24);
INSERT INTO DEPOSITOR VALUES('HOUSE',25);
INSERT INTO DEPOSITOR VALUES('HOUSE',26);
INSERT INTO DEPOSITOR VALUES('HOUSE',27);
INSERT INTO DEPOSITOR VALUES('HOUSE',28);
INSERT INTO DEPOSITOR VALUES('STAN',1);
INSERT INTO DEPOSITOR VALUES('STAN',2);
INSERT INTO DEPOSITOR VALUES('ERIC',3);
INSERT INTO DEPOSITOR VALUES('STAN',4);
INSERT INTO DEPOSITOR VALUES('STAN',5);
INSERT INTO DEPOSITOR VALUES('STAN',6);
INSERT INTO DEPOSITOR VALUES('STAN',7);
INSERT INTO DEPOSITOR VALUES('STAN',8);
INSERT INTO DEPOSITOR VALUES('STAN',9);
INSERT INTO DEPOSITOR VALUES('STAN',19);
INSERT INTO DEPOSITOR VALUES('ERIC',11);
INSERT INTO DEPOSITOR VALUES('ERIC',21);
INSERT INTO DEPOSITOR VALUES('ERIC',20);
INSERT INTO DEPOSITOR VALUES('ERIC',12);
INSERT INTO DEPOSITOR VALUES('ERIC',13);
INSERT INTO DEPOSITOR VALUES('ERIC',14);
INSERT INTO DEPOSITOR VALUES('ERIC',15);

INSERT INTO DEPOSITOR VALUES('BUTTERS',16);
INSERT INTO DEPOSITOR VALUES('LILA',17);
INSERT INTO DEPOSITOR VALUES('DEXTER',18);

INSERT INTO LOAN VALUES(1,'MAIN',5000);
INSERT INTO LOAN VALUES(2,'BLRSUB1',1500);
INSERT INTO LOAN VALUES(3,'MAIN',10000);
INSERT INTO LOAN VALUES(4,'MLRSUB2',3500);
INSERT INTO LOAN VALUES(5,'SHMGABRACNH',20000);

INSERT INTO BORROWER VALUES('ERIC',2);
INSERT INTO BORROWER VALUES('ERIC',1);
INSERT INTO BORROWER VALUES('STAN',3);
INSERT INTO BORROWER VALUES('LILA',4);
INSERT INTO BORROWER VALUES('DEXTER',5);


SELECT CNAME FROM ACCOUNT A,DEPOSITOR D WHERE A.ACCNO=D.ACCNO AND BNAME='MAIN' GROUP BY CNAME HAVING COUNT(*)>1;


/* METHOD 1 */
SELECT C1.CNAME 
	FROM CUST C1 
	WHERE NOT EXISTS (SELECT B1.BNAME 
				FROM BRANCH B1 
				WHERE B1.BNAME IN (SELECT B2.BNAME 
							FROM BRANCH B2 
							WHERE B2.CITY='BLR') 
				AND 
				NOT EXISTS(SELECT * 
						FROM ACCOUNT A,DEPOSITOR D 
						WHERE A.ACCNO=D.ACCNO AND A.BNAME=B1.BNAME AND D.CNAME=C1.CNAME));
							

/* METHOD 2 */
SELECT C1.CNAME
	FROM CUST C1
	WHERE NOT EXISTS (SELECT A2.BNAME 
				FROM ACCOUNT A2, BRANCH B1
				WHERE A2.BNAME=B1.BNAME
				AND B1.CITY='BLR'
				AND B1.BNAME NOT IN (SELECT A1.BNAME 
							FROM DEPOSITOR D1,ACCOUNT A1
							WHERE D1.ACCNO=A1.ACCNO
							AND	D1.CNAME=C1.CNAME));

SYSTEM echo "Before deleteing...";
SELECT * FROM ACCOUNT;
DELETE FROM ACCOUNT WHERE BNAME IN (SELECT BNAME FROM BRANCH WHERE CITY='MLR');
SYSTEM echo "After deleteing...";
SELECT * FROM ACCOUNT;


/* EXTRA QUERRIES */

