CREATE SCHEMA STUDENT_BOOK;

USE STUDENT_BOOK;

CREATE TABLE STUDENT
(
REGNO VARCHAR(5) PRIMARY KEY,
NAME VARCHAR(30) NOT NULL,
MAJOR VARCHAR(10) NOT NULL,
BDATE DATE NOT NULL
);

CREATE TABLE COURSE
(
CNO INT PRIMARY KEY,
CNAME VARCHAR(30) NOT NULL,
DEPT VARCHAR(30) NOT NULL
);

CREATE TABLE ENROLL
(
REGNO VARCHAR(5),
CNO INT,
SEM INT,
MARKS INT NOT NULL,
PRIMARY KEY(REGNO,CNO,SEM),
FOREIGN KEY(REGNO) REFERENCES STUDENT(REGNO) ON DELETE CASCADE,
FOREIGN KEY(CNO) REFERENCES COURSE(CNO) ON DELETE CASCADE
);

CREATE TABLE TEXT
(
ISBN INT PRIMARY KEY,
TITLE VARCHAR(30) NOT NULL,
PUBLISHER VARCHAR(10) NOT NULL,
AUTHOR VARCHAR(30) NOT NULL
);

CREATE TABLE BAD
(
CNO INT,
SEM INT,
ISBN INT NOT NULL,
FOREIGN KEY(CNO) REFERENCES COURSE(CNO) ON DELETE CASCADE,
FOREIGN KEY(ISBN) REFERENCES TEXT(ISBN) ON DELETE CASCADE
);

-- STUDENT
INSERT INTO STUDENT VALUES('CS42','MIKHIL','CSE','1986-12-17');
INSERT INTO STUDENT VALUES('CS48','MUJEEB','CSE','1986-09-02');
INSERT INTO STUDENT VALUES('EC26','PRADEEP','CSE','1987-0-16');
INSERT INTO STUDENT VALUES('EE37','MAJID','ISE','1986-05-28');
INSERT INTO STUDENT VALUES('IS48','WAJID','ISE','1986-05-28');

-- COURSE
INSERT INTO COURSE VALUES(1,'.NET','COMPUTER SCIENCE');
INSERT INTO COURSE VALUES(2,'J2EE','COMPUTER SCIENCE');
INSERT INTO COURSE VALUES(6,'ADA','COMPUTER SCIENCE');
INSERT INTO COURSE VALUES(3,'MIS','INFORMATION SCIENCE');
INSERT INTO COURSE VALUES(4,'FS','INFORMATION SCIENCE');
INSERT INTO COURSE VALUES(5,'ORACLE','COMPUTER SCIENCE');

-- ENROLL
INSERT INTO ENROLL VALUES('CS42',1,6,98);
INSERT INTO ENROLL VALUES('CS48',2,6,97);
INSERT INTO ENROLL VALUES('EC26',5,5,50);
INSERT INTO ENROLL VALUES('IS48',3,7,90);
INSERT INTO ENROLL VALUES('EE37',4,4,80);
INSERT INTO ENROLL VALUES('CS48',1,6,35);

-- TEXT
INSERT INTO TEXT VALUES(101,'LET US C','LPE','FAHAD');
INSERT INTO TEXT VALUES(102,'C++','ABC','MUJEEB');
INSERT INTO TEXT VALUES(103,'ORACLE','DEF','OTHMAN');
INSERT INTO TEXT VALUES(104,'.NET','LPE','NAUSHAD');
INSERT INTO TEXT VALUES(105,'J2EE','PEARSON','MIKHIL');
INSERT INTO TEXT VALUES(106,'DBMS','MCGRAW','NUKUL');
INSERT INTO TEXT VALUES(107,'JAVA','PRISM','NAIN');
INSERT INTO TEXT VALUES(108,'OOPS','WILEY','BALGURUSWAMY');
INSERT INTO TEXT VALUES(109,'ANSI C','PEARSON','MIKHIL');

-- BAD
INSERT INTO BAD VALUES(1,6,101);
INSERT INTO BAD VALUES(2,6,103);
INSERT INTO BAD VALUES(1,6,106);
INSERT INTO BAD VALUES(2,6,107);
INSERT INTO BAD VALUES(1,6,108);
INSERT INTO BAD VALUES(2,6,109);
INSERT INTO BAD VALUES(3,5,102);
INSERT INTO BAD VALUES(4,4,104);
INSERT INTO BAD VALUES(5,7,105);

INSERT INTO TEXT VALUES(110,'FLAT','PEARSON','PADMA REDDY');
INSERT INTO BAD VALUES(3,6,110);

SELECT * FROM TEXT T,BAD B2 
	WHERE T.ISBN=B2.ISBN
	AND B2.CNO IN (SELECT C1.CNO
			FROM COURSE C1,BAD B1
			WHERE C1.CNO=B1.CNO 
			AND C1.DEPT='COMPUTER SCIENCE'
			GROUP BY C1.CNO HAVING COUNT(B1.ISBN) > 2)
	ORDER BY T.TITLE ASC;

SELECT C.DEPT FROM COURSE C,BAD B 
	WHERE C.CNO=B.CNO
	AND B.ISBN IN (SELECT ISBN FROM TEXT WHERE PUBLISHER='PEARSON');

