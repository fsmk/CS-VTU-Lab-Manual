CREATE SCHEMA INSURANCE;

USE INSURANCE;

CREATE TABLE PERSON
(
DRIVERID VARCHAR(5) PRIMARY KEY,
NAME VARCHAR(30),
ADDRESS VARCHAR(50)
);

CREATE TABLE CAR
(
REGNO VARCHAR(5) PRIMARY KEY,
MODEL VARCHAR(25),
YEAR INT
);

CREATE TABLE ACCIDENT
(
REPORTNO INT PRIMARY KEY,
ACCDATE DATE,
LOCATION VARCHAR(30)
);

CREATE TABLE OWNS
(
DRIVERID VARCHAR(5),
REGNO VARCHAR(5),
PRIMARY KEY(DRIVERID,REGNO),
FOREIGN KEY(DRIVERID) REFERENCES PERSON(DRIVERID) ON DELETE CASCADE,
FOREIGN KEY(REGNO) REFERENCES CAR(REGNO) ON DELETE CASCADE
);

CREATE TABLE PARTICIPATED
(
DRIVERID VARCHAR(5),
REGNO VARCHAR(5),
REPORTNO INT,
DAMAGES INT,
PRIMARY KEY(DRIVERID,REGNO,REPORTNO),
FOREIGN KEY(DRIVERID) REFERENCES PERSON(DRIVERID) ON DELETE CASCADE,
FOREIGN KEY(REGNO) REFERENCES CAR(REGNO) ON DELETE CASCADE,
FOREIGN KEY(REPORTNO) REFERENCES ACCIDENT(REPORTNO) ON DELETE CASCADE
);

-- PERSON
INSERT INTO PERSON VALUES (1,'ABC','HKBKCE,NAGAWARA');
INSERT INTO PERSON VALUES (2,'BCD','ATRIA,YELAHANKA');
INSERT INTO PERSON VALUES (3,'ADE','RAMAHIAH,NEAR IISC');
INSERT INTO PERSON VALUES (4,'CFG','MVJCE,WHITEFIELD');
INSERT INTO PERSON VALUES (5,'RTE','PESIT,NAYADAHALLI');
INSERT INTO PERSON VALUES (6,'TER','CAR STREET,MLORE');


-- CAR
INSERT INTO CAR VALUES ('A1','MERC',2007);
INSERT INTO CAR VALUES ('A2','PORSCHE',2005);
INSERT INTO CAR VALUES ('B2','ROLLS ROYCE',2006);
INSERT INTO CAR VALUES ('B4','FERRARI',1999);
INSERT INTO CAR VALUES ('C1','BENTLEY',2000);
INSERT INTO CAR VALUES ('D2','MAYBACH',2007);
INSERT INTO CAR VALUES ('G2','AUDI',1998);
INSERT INTO CAR VALUES ('T5','MARUTI 800',1999);
INSERT INTO CAR VALUES ('F2','SANTRO',2009);


-- ACCIDENT
INSERT INTO ACCIDENT VALUES (1,'2006-01-01','DOMLUR');
INSERT INTO ACCIDENT VALUES (2,'2007-02-05','M.G.ROAD');
INSERT INTO ACCIDENT VALUES (3,'2006-12-02','R.T.NAGAR');
INSERT INTO ACCIDENT VALUES (4,'2006-03-28','YELAHANKA');
INSERT INTO ACCIDENT VALUES (5,'2007-01-26','KORAMANGLA');
INSERT INTO ACCIDENT VALUES (6,'2007-02-04','MAJESTIC');

-- OWNS
INSERT INTO OWNS VALUES (1,'A1');
INSERT INTO OWNS VALUES (2,'A2');
INSERT INTO OWNS VALUES (2,'C1');
INSERT INTO OWNS VALUES (3,'B2');
INSERT INTO OWNS VALUES (4,'B4');
INSERT INTO OWNS VALUES (5,'D2');
INSERT INTO OWNS VALUES (6,'G2');
INSERT INTO OWNS VALUES (3,'T5');
INSERT INTO OWNS VALUES (2,'F2');

-- PARTICIPATED
INSERT INTO PARTICIPATED VALUES (1,'A1',1,500);
INSERT INTO PARTICIPATED VALUES (2,'A2',1,2000);
INSERT INTO PARTICIPATED VALUES (3,'B2',1,1000);
INSERT INTO PARTICIPATED VALUES (1,'A1',2,1500);
INSERT INTO PARTICIPATED VALUES (2,'C1',2,800);
INSERT INTO PARTICIPATED VALUES (4,'G2',2,800);
INSERT INTO PARTICIPATED VALUES (1,'F2',2,800);
INSERT INTO PARTICIPATED VALUES (3,'F2',2,800);
INSERT INTO PARTICIPATED VALUES (5,'D2',3,750);
INSERT INTO PARTICIPATED VALUES (2,'C1',3,600);
INSERT INTO PARTICIPATED VALUES (1,'A1',3,200);
INSERT INTO PARTICIPATED VALUES (5,'D2',4,1000);
INSERT INTO PARTICIPATED VALUES (2,'A2',5,1200);
INSERT INTO PARTICIPATED VALUES (3,'B2',6,10000);
INSERT INTO PARTICIPATED VALUES (2,'A1',6,5000);
 
-- UPDATING DAMAGE AMOUNT OF AN ACCIDENT WHOSE REPORTNO AND CAR'S REGNO IS SPECIFIED AS 4 AND 'D2' RESPECTIVELY
UPDATE PARTICIPATED SET DAMAGES=25000 WHERE REPORTNO=4 AND REGNO='D2';

-- ADDING A NEW ACCIDENT TO THE DATABASE
INSERT INTO ACCIDENT VALUES (7,'2007-03-14','NAGAWARA');
INSERT INTO PARTICIPATED VALUES (2,'A1',7,15000);

-- TOTAL NUMBER OF PEOPLE WHO OWN CARS THAT WERE INVOLVED ACCIDENTS OF THE YEAR 2006
SELECT COUNT(DISTINCT O.DRIVERID) 
	FROM PARTICIPATED P,ACCIDENT A,OWNS O
	WHERE P.REPORTNO=A.REPORTNO
	AND  O.DRIVERID=P.DRIVERID
	AND ACCDATE LIKE '2006%'
	AND P.REGNO=O.REGNO;

-- NUMBER OF ACCIDENTS IN WHICH CARS BELONGING TO A SPECIFIC MODEL (PORSCHE) WERE INVOLVED
SELECT COUNT(*) FROM CAR C,PARTICIPATED P WHERE MODEL='PORSCHE' AND C.REGNO=P.REGNO;

-- OWNER OF CAR WHICH IS INVOLVED IN ACCIDENT ON 5TH FEB 2007 AND DAMAGE AMOUNT LESS THAN 100000
SELECT P.NAME 
	FROM PERSON P, OWNS O, CAR C
	WHERE P.DRIVERID=O.DRIVERID
	AND O.REGNO=C.REGNO
	AND C.REGNO IN (SELECT PA.REGNO 
				FROM ACCIDENT A,PARTICIPATED PA
				WHERE PA.REPORTNO=A.REPORTNO
				AND A.ACCDATE='2007-02-05'
				AND DAMAGES < 10000
			);
